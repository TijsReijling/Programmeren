---
title: "Template"
author: "Studentnames and studentnumbers here"
date: "`r Sys.Date()`"
output:
  pdf_document: default
---

# Set-up your environment

```{r package_install, include=FALSE}
if (!requireNamespace("tidyverse", quietly = TRUE)) install.packages("tidyverse")
if (!requireNamespace("yaml", quietly = TRUE)) install.packages("yaml")
if (!requireNamespace("rmarkdown", quietly = TRUE)) install.packages("rmarkdown")
if (!requireNamespace("dplyr", quietly = TRUE)) install.packages("dplyr")
if (!requireNamespace("cbsodataR", quietly = TRUE)) install.packages("cbsodataR")
if (!requireNamespace("sf", quietly = TRUE)) install.packages("sf")
if (!requireNamespace("readr", quietly = TRUE)) install.packages("readr")
```

```{r packages}
library(tidyverse)
library(rmarkdown)
library(yaml)
library(dplyr)
library(cbsodataR)
library(sf)
library(readr)
```

# Title Page

Include your names

Tutorial group 4

C. Schouwenaar

# Part 1 - Identify a Social Problem

Use APA referencing throughout your document. [Here's a link to some explanation.](https://www.mendeley.com/guides/apa-citation-guide/)

## 1.1 Describe the Social Problem

Topic: How does income inequality contribute to differences in health and life expectancy between high- and low-income groups in the Netherlands?

In the Netherlands, healthcare is universally granted to all citizens through mandatory health insurance. The government promotes healthcare equality through regulations that ensures equal access to services by prohibiting insurance companies to decline clients. Yet, low-income groups in the Netherlands still experience worse health outcomes than their wealthier counterparts.

Research by the Ministry of Health, Welfare and Sport shows that college or university-educated people, which correlates with a higher income, consistently score higher on health outcomes. VZinfo found that people with primary or VMBO-level education were significantly more likely to smoke, have obesity, and rate their health as “poor” compared to their higher educated peers (VZinfo, 2023).

Institutions like the CBS document imbalances between income level and life expectancy. Their analyses show that the wealthiest group in society lives, on average, eight years longer and spend 25 more years in good health than those in the lowest-income group. (Centraal Bureau voor de Statistiek [CBS], 2022).

Pharos provides us with more disparities by emphasising socio-economic differences in health. According to Pharos, receiving welfare benefits correlates with poorer health. They state that with each step up on the social ladder, their chance of good health increases (Pharos, 2022). These health differences across different income groups undermine social cohesion, which makes health inequality based on ones health a social problem that needs to be examined.

Why is this relevant? Wealth inequality in the Netherlands is growing, making these differences even more apparent. Factors like increasing housing costs, job security and education gaps contribute to the widening differences between low- and high-income individuals.

This debate about health inequality isn’t new. Some policy makers have been proposing to cut deductibles (eigen risico) since they contribute to people with lower incomes delaying their care. We aim to analyse this inequality to quantify how large these differences are and identify their potential causes.

What has not been examined extensively is whether this inequality holds true across Dutch municipalities. Our aim is to analyse if this inequality hold true throughout the Netherlands, and identify regional differences in the relationship between wealth and health.

# Part 2 - Data Sourcing

## 2.1 Load in the data

Preferably from a URL, but if not, make sure to download the data and store it in a shared location that you can load the data in from. Do not store the data in a folder you include in the Github repository!

```{r loading_data}
setwd("~/GitHub/Programmeren/data")

Welzijn_Goed <- read_csv("Welzijn.goed.csv")

Ervaren_Gezondheid <- read_csv("Ervaren_Gezondheid.csv")

Levensverwachting <- read_csv("Levensverwachting.csv")

Ervaren_gezondheid_wijk <- read_delim("Ervarengezondheid_Wijk&Buurt.csv", delim = ";")

Inkomen_per_gemeente <- read_delim("Inkomen_gemeente.csv", delim = ";")

Levensverwachting_Gemeente <- read_delim("Levensverwacht_Gemeente_Wijk&Buurt.csv", delim = ";")

ErvarenGezondheidNL <- read_csv("ErvarenGezondheidNL.csv")

gemeentegrenzen <- st_read("https://service.pdok.nl/cbs/gebiedsindelingen/2023/wfs/v1_0?request=GetFeature&service=WFS&version=2.0.0&typeName=gemeente_gegeneraliseerd&outputFormat=json")
```

midwest is an example dataset included in the tidyverse package

## 2.2 Provide a short summary of the dataset(s)

```{r}
head(Welzijn_Goed)

```

This data set contains and presents figures on the wellness/well-being of the population of the Netherlands aged 18 years or older. This factors in happiness and satisfaction with life, satisfaction with education, work, travel, daily activities, weight, financial situation, housing, living environment social life and total amount of time spent on leisure. In addition, concerns about financial future, feelings of insecurity and trust in others are included. This data can be categorized by gender, age, education level and origin.

[URL of the data download page](https://opendata.cbs.nl/statline/portal.html?_la=nl&_catalog=CBS&tableId=85542NED&_theme=178)

```{r}
head("Ervaren_Gezondheid.csv")
```

The table contains estimated percentages of indicators related to health, social situation, and lifestyle at neighborhood, district, and municipal levels, based on a conducted survey.

[URL of the data download page](https://statline.rivm.nl/portal.html?_la=nl&_catalog=RIVM&tableId=50120NED&_theme=94)

```{r}
head("Levensverwachting.csv")
```

This dataset provides us with information about the life expectancy across different periods between 1996-2022.The numbers are provided on a national and municipal level. The data at the municipal level are calculated on the basis of a 4-year period.

[URL 0f the data download page]((https://statline.rivm.nl/portal.html?_la=nl&_catalog=RIVM&tableId=50132NED&_theme=101))

```{r}
head("Ervarengezondheid_Wijk&Buurt.csv")
```

The table contains self-reported health indicators through a questionnaire about health, social situation, and lifestyle at neighborhood, district, and municipal levels. The average of all people living in a municipality or neighbourhood is computed.

[URL of the data download page](https://statline.rivm.nl/portal.html?_la=nl&_catalog=RIVM&tableId=50120NED&_theme=94)

```{r}
head("Inkomen_gemeente.csv")
```

For each household within a municipality or neighbourhood, the total household income was calculated and then divided by the number of household members. This results in the average income per person, which accounts for differences in household size and provides a more accurate measure of individual economic well-being.

[URL of the data download page](https://www.cbs.nl/nl-nl/maatwerk/2023/35/inkomen-per-gemeente-en-wijk-2020)

``` r
inline_code = TRUE
```

These are things that are usually included in the metadata of the dataset. For your project, you need to provide us with the information from your metadata that we need to understand your dataset of choice.

## 2.3 Describe the type of variables included

Think of things like:

-   Do the variables contain health information or SES information?

-   Have they been measured by interviewing individuals or is the data coming from administrative sources?

*For the sake of this example, I will continue with the assignment...*

# Part 3 - Quantifying

## 3.1 Data cleaning

Say we want to include only larger distances (above 2) in our dataset, we can filter for this.

```{r data_cleaning}



#mean(dataset$percollege)
```

Please use a separate 'R block' of code for each type of cleaning. So, e.g. one for missing values, a new one for removing unnecessary variables etc.

## 3.2 Generate necessary variables

Variable 1

```{r gen_var1}
gemeente_cor <- gemeente_wijk_data %>%
  group_by(statnaam) %>%
  filter(n() >= 3) %>%
  summarise(
    correlation = if (sum(complete.cases(as.numeric(Gemiddeld, ErvarenGezondheidGoedZeerGoed_4))) > 1)
      {cor(as.numeric(Gemiddeld), as.numeric(ErvarenGezondheidGoedZeerGoed_4), use = "complete.obs")} 
    else {NA_real_})

###!!! CHECK IF THIS PART BELOW HAS TO BE EVEN IN HERE!!!###
#This isnt creating new var, but adding to new data set
#trimming white spaces so I can add the geometry for the heat map
gemeentegrenzen <- gemeentegrenzen %>%
  mutate(statnaam = tolower(trimws(statnaam)))
gemeente_cor <- gemeente_cor %>%
  mutate(statnaam = tolower(trimws(statnaam)))

gemeente_wijk_mapdata <- gemeentegrenzen %>%
  left_join(gemeente_cor, by = "statnaam")
```

We decided to make a new variable called "correlation" that we added

Variable 2

```{r gen_var2}

```

## 3.3 Visualize temporal variation

```{r}
ggplot(Ervaren_Gezondheid, 
       aes(x = Perioden, y = ErvarenGezondheidGoedZeerGoed_4,
           colour = Gemeentenaam_1, group = Gemeentenaam_1)) +
  geom_line(size = 1.5) +
  geom_text(aes(label = ErvarenGezondheidGoedZeerGoed_4),
            colour = "black", 
            vjust = -1,
            show.legend = F) +
  geom_point(colour = "black", size = 2.5, show.legend = F) +
  
  scale_colour_manual(values = c("#C41230", "#39B54A", "black")) +
  scale_x_discrete(label = c(2012, 2016, 2020)) +
  scale_y_continuous(
    limits = c(65, 80),
    breaks = seq(0, 100, by = 5)) +
  
  labs(x = "Year (2012, 2016, 2020)", 
       y = "Perceived Health (% Good or Very Good)",
       title = "Perceived Health per Municipality (2012-2020)",
       colour = "Municipality") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

```{r}
ggplot(Ervaren_Gezondheid_NL_AM_RO, 
       aes(x = Perioden, y = ErvarenGezondheidGoedZeerGoed_4,
           colour = Region, group = Region)) +
  geom_line(size = 1.5) +
  geom_point(colour = "black", size = 2.5, show.legend = FALSE) +
  geom_text(aes(label = ErvarenGezondheidGoedZeerGoed_4,
                vjust = ifelse(Region == "The Netherlands", -0.8, 1.9)),
            colour = "black", 
            show.legend = FALSE) +
  scale_colour_manual(values = c(
    "Amsterdam" = "#C41230",
    "Rotterdam" = "#39B54A",
    "The Netherlands" = "orange"
  )) +
  scale_x_discrete(labels = c("2012", "2016", "2020")) +
  scale_y_continuous(limits = c(65, 80), breaks = seq(0, 100, by = 5)) +
  labs(
    x = "Year (2012, 2016, 2020)",
    y = "Perceived health (% wel or very well)",
    title = "Perceived Health per Municipality",
    colour = "Region"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

## 3.4 Visualize spatial variation

```{r visualise_map}
ggplot(gemeente_wijk_mapdata) +
  geom_sf(aes(fill = correlation)) + 
  theme_minimal() +
  scale_fill_gradient2(high = "#6A0DAD", mid = "lightgrey", low = "#FFD700",
                       limits = c(-1, 1),
                       breaks = c(-1, -0.5, 0, 0.5, 1),
                       name = "Correlation 'income & health'") +
  theme(legend.position = "left") + 
  labs(caption = "Grey areas = insufficient data") 

```

Here you provide a description of why the plot above is relevant to your specific social problem.

## 3.5 Visualize sub-population variation

What is the poverty rate by state?

```{r visualise_subpopulations}
ggplot(Welzijn_temporal_visualization, aes(x = Jaar, y = WelzijnIndex, color = Opleidingsniveau, group = Opleidingsniveau)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = 2015:2018) +
  scale_color_manual(
    values = c(
      "Basisonderwijs" = "#F8766D",
      "Vmbo, havo-, vwo-onderbouw, mbo1" = "#C49A00",
      "Havo, vwo, mbo2-4" = "#00BA38",
      "Hbo-, wo-bachelor" = "#00BFC4",
      "Hbo-, wo-master, doctor" = "#C77CFF"
    )
  ) +
  labs(
    title = "Evolution of Welfare Index per Level of Education (2015–2018)",
    x = "Year",
    y = "Welfare Index",
    color = "Education level"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 9, face = "bold", hjust = 0.5),
    axis.title.x = element_text(margin = margin(t = 10)),
    axis.title.y = element_text(margin = margin(r = 10))
  )
```

Here you provide a description of why the plot above is relevant to your specific social problem.

## 3.6 Event analysis

```{r Event_analysis}
Ervaren_Gezondheid$ErvarenGezondheidGoedZeerGoed_4 <- as.numeric(Ervaren_Gezondheid$ErvarenGezondheidGoedZeerGoed_4)
ggplot(Ervaren_Gezondheid, aes(x = Perioden, y = ErvarenGezondheidGoedZeerGoed_4, colour = Gemeentenaam_1, group = Gemeentenaam_1)) +

geom_line(size = 1.5) + geom_text(aes(label = ErvarenGezondheidGoedZeerGoed_4), colour = "black", vjust = -1, show.legend = FALSE) + geom_point(colour = "black", size = 2.5, show.legend = FALSE) +

geom_segment(aes(x = 2, xend = 2, y = 68.4 - 1.7, yend = 68.4 + 2.1), color = "black", linewidth = 0.4) + annotate("text", x = 2, y = 69.9 - 3.3, label = "Rotterdam Vitaal en Healthy", color = "black", angle = 0, vjust = 1, size = 3) +

geom_segment(aes(x = 2.33, xend = 2.33, y = 73.8 - 0.4, yend = 73.8 + 2.8), color = "black", linewidth = 0.4) + annotate("text", x = 2.25, y = 79 - 1.3, label = "Amsterdam Vitaal & Gezond", color = "black", angle = 0, vjust = 1, size = 3) +

scale_colour_manual(values = c("Amsterdam" = "#C41230", "Rotterdam" = "#39B54A")) + scale_x_discrete(label = c(2012, 2016, 2020)) + scale_y_continuous(limits = c(65, 80), breaks = seq(0, 100, 5)) +

labs( x = "Year (2012, 2016, 2020)", y = "Perceived Health (% Good or Very Good)", title = "Perceived Health per Municipality (2012-2020)", colour = "Municipality" ) + theme_minimal() + theme(legend.position = "bottom")
```

Analyze the relationship between two variables.

Here you provide a description of why the plot above is relevant to your specific social problem.

# Part 4 - Discussion

## 4.1 Discuss your findings

# Part 5 - Reproducibility

## 5.1 Github repository link

<https://github.com/TijsReijling/Programmeren>

## 5.2 Reference list

#Bovenaan welvaartsladder bijna 25 jaar langer in goede gezondheid. (2022, December 20). Centraal Bureau Voor De Statistiek. <https://www.cbs.nl/nl-nl/nieuws/2022/51/bovenaan-welvaartsladder-bijna-25-jaar-langer-in-goede-gezondheid>?

#Pharos. (2022, July). Sociaal economische Gezondheidsverschillen (SEGV). <https://www.pharos.nl/factsheets/sociaaleconomische-gezondheidsverschillen-segv/>

#Sociaaleconomische gezondheidsverschillen \| Volksgezondheid en Zorg. (n.d.). <https://www.vzinfo.nl/sociaaleconomische-gezondheidsverschillen>

These sources include links to the datasets and their corresponding metadata.

Gezonde levensverwachting; inkomen en welvaart. (2025, May 23). CBS dataportaal. <https://opendata.cbs.nl/statline/portal.html?_la=nl&_catalog=CBS&tableId=85445NED&_theme=154>

Welzijn; kerncijfers, persoonskenmerken. (2025, March 20). CBS dataportaal. <https://opendata.cbs.nl/statline/portal.html?_la=nl&_catalog=CBS&tableId=85542NED&_theme=178>

Inkomen per gemeente en wijk, 2020. (2023, September 1). Centraal Bureau voor de Statisktiek. <https://www.cbs.nl/nl-nl/maatwerk/2023/35/inkomen-per-gemeente-en-wijk-2020> (metadata included in dataset)

Gezondheid per wijk en buurt; 2012/2016/2020/2022. (2024, December 09). RIVM dataportaal. <https://statline.rivm.nl/portal.html?_la=nl&_catalog=RIVM&tableId=50120NED&_theme=94>

Levensverwachting op de leeftijd 0 en 65 jaar; geslacht, regio 1996-2022. (2024, December 9). RIVM dataportaal. <https://statline.rivm.nl/portal.html?_la=nl&_catalog=RIVM&tableId=50132NED&_theme=101>
